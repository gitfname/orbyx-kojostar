import{r as j,j as t,B as re,m as ie}from"./index-d8fa4cee.js";import{G as ae,u as le,Z as me,b as _e,L as de,R as ce,o as fe,p as he}from"./App-8c327c57.js";import{g as ge}from"./getSingleJob-14673a87.js";import{J as ue,I as xe,H as ye}from"./JobImageSlider_1-7488ec97.js";import{C as pe}from"./CommentsSection_1-408f24cb.js";import{W as ve,g as je}from"./getDayNameByIndex-1347c9b0.js";import{b as Ne}from"./index.esm-94f80b75.js";import{M as be}from"./index.modern-44684203.js";import{M as B}from"./Modal_2-978c532b.js";import{A as we,T as Ie,B as Ce,v as te,G as ze,d as ne}from"./v4-19ade882.js";import{l as He}from"./TileLayer-7e84408f.js";import{u as Se}from"./chunk-ENIANY67-29a1425c.js";import"./chunk-XY72533R-a83d5600.js";import"./chunk-ROURZMX4-7a6e0355.js";import"./objectWithoutProperties-50301d67.js";import"./index-c7f77353.js";import"./index-a2bf4718.js";import"./chunk-VFYM6BU6-d8b2c4d2.js";function L(p){return ae({tag:"svg",attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"path",attr:{d:"M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"}},{tag:"path",attr:{d:"M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"}}]})(p)}function T({onChange:p,placeHolder:N,title:v,textArea:I=!1}){const b=j.useRef(void 0),g=j.useRef(void 0),u=()=>{b.current&&b.current(),p(g.current.value)};return t.jsx(B,{title:v,close:z=>b.current=z,modalBody:t.jsxs("div",{children:[I?t.jsx("textarea",{ref:g,rows:4,className:"primary-text-input py-3",placeholder:N}):t.jsx("input",{ref:g,type:"text",className:"primary-text-input py-3",placeholder:N}),t.jsx("button",{onClick:u,className:`w-full max-w-xs block mx-auto rounded-xl bg-emerald-600 text-gray-50\r
            font-[vazir] py-2 text-sm mt-8 active:scale-95 transition-all duration-300`,children:"ذخیره"})]}),children:t.jsx("div",{className:"p-1.5 rounded-lg hover:bg-emerald-500/10 cursor-pointer transition-colors duration-300",children:t.jsx(L,{className:"w-4 h-4 fill-transparent stroke-emerald-500"})})})}async function ke({address:p,desc:N,phones:v,title:I,id:b,hashtags:g}){const u=new FormData;u.append("id",b),u.append("title",I),u.append("description",N),u.append("address",p),u.append("hashtags",g),v.forEach(w=>u.append("phones[]",w));const z={method:"POST",headers:{Accept:"application/json",Authorization:"Bearer "+le.getState().user.token},body:u};return await(await fetch(me,z)).json()}const i=(p,N=8,v=0)=>p||ne().set("hour",N).set("minute",v);function Ke(){var M,R,$,J,O,W,P,G,F,U,q,V,Z;const{id:p}=re();j.useState(!1);const N=Se(),[v,I]=j.useState(void 0),b=ie(n=>n.setIsLoading),[g,u]=j.useState(void 0),z=j.useRef(void 0),[e,w]=j.useState([]),{data:C,error:oe,isLoading:A}=_e("admin/job/view/"+p,async()=>ge({jobId:parseInt(p)}),{shouldRetryOnError:!1,focusThrottleInterval:1e3}),[r,S]=j.useState(void 0);j.useEffect(()=>{if(C&&!A&&!r){S(C),I(C.job.phones.map(o=>({id:parseInt(o),value:o}))),u(C.job.hashtags.map(o=>({id:o,value:o})));const n=o=>{if(o!=null&&o.split){const[m,k]=o.split(":");return ne().set("hour",parseInt(m)).set("minute",parseInt(k))}};w(C.plan.map(o=>(console.log(typeof(o==null?void 0:o.start_afternoon_time)=="string"),{is_holiday:o.is_holiday,start_afternoon_time:o.start_afternoon_time?n(o.start_afternoon_time):null,end_afternoon_time:o.end_afternoon_time?n(o.end_afternoon_time):null,start_morning_time:o.start_morning_time?n(o.start_morning_time):null,end_morning_time:o.end_morning_time?n(o.end_morning_time):null,is_afternoon_holiday:!o.start_afternoon_time,is_morning_holiday:!o.start_morning_time,day:o.day})))}},[C,A]),j.useEffect(()=>{e&&e.forEach(n=>{console.log(n)})},[e]);const se=()=>{b(!0),ke({id:p,address:r.job.address,title:r.job.title,desc:r.job.description,phones:v.map(n=>n.value),hashtags:g.map(n=>n.value).join("|")}).then(n=>{N({description:n.message,duration:3e3,position:"top-right",isClosable:!0,status:"success"}),b(!1)}).catch(()=>{b(!1),N({description:"مشکلی رخ داد. لطفا بعدا دوباره امتحان کنید",duration:3e3,position:"top-right",isClosable:!0,status:"error"})})};return A||!r?t.jsx(de,{}):oe?t.jsx("p",{children:"something went wrong"}):t.jsxs("div",{className:"max-lg:h-full h-screen overflow-y-auto pb-8",children:[t.jsx("div",{className:"w-full h-[34rem] md:h-[38rem]",children:t.jsx(ue,{images:(M=r==null?void 0:r.job)==null?void 0:M.medias.map(n=>n.url)})}),t.jsx("div",{className:"mt-6 z-10 w-full flex items-center justify-center gap-x-3 relative",children:t.jsx("div",{className:"flex flex-col gap-y-4 items-center justify-center",children:t.jsx(ce,{max:5,positive:Math.floor((R=r==null?void 0:r.job)==null?void 0:R.rate)})})}),t.jsxs("div",{className:"flex items-center gap-x-2 px-4 mt-9",children:[t.jsx(xe,{className:"w-5 h-5 fill-blue-500"}),t.jsx("p",{className:"text-sm text-slate-800 font-[vazir]",children:"اطلاعات مجموعه"})]}),t.jsx("div",{className:"mt-4 w-full px-5",children:t.jsxs("div",{className:"w-full rounded-xl bg-blue-500/10 p-5 flex flex-col gap-y-4",children:[t.jsxs("p",{className:"text-xs text-slate-500 font-[vazir] flex items-center",children:["نام مجموعه :  ",t.jsx("span",{className:"text-slate-800 font-[vazir]",children:($=r==null?void 0:r.job)==null?void 0:$.title}),"   ",t.jsx(T,{title:"تغییر نام",placeHolder:"نام جدید را وارد کنید",onChange:n=>{S(o=>{const m=o;return m.job.title=n,{...m}})}})]}),t.jsxs("p",{className:"text-xs text-slate-500 font-[vazir] flex items-center",children:["شماره تماس :  ",t.jsx("div",{className:"inline-flex items-center gap-x-2.5",children:v==null?void 0:v.map(n=>t.jsx("a",{href:"tel:"+n.value,className:"text-blue-500 font-[vazir]",children:n.value},n.id))}),"  ",t.jsx(B,{title:"افزودن شماره تماس",modalBody:t.jsx("div",{className:"w-full space-y-3 pb-2",children:t.jsx(we,{phoneNumbers:v,setPhoneNumbers:n=>{I(n)}})}),children:t.jsx("div",{className:"p-1.5 rounded-lg hover:bg-emerald-500/10 cursor-pointer transition-colors duration-300",children:t.jsx(L,{className:"w-4 h-4 fill-transparent stroke-emerald-500"})})})]}),t.jsxs("p",{className:"text-xs text-slate-500 font-[vazir] flex items-center",children:["آدرس :  ",t.jsx("span",{className:"text-slate-800 font-[vazir]",children:(J=r==null?void 0:r.job)==null?void 0:J.address}),"   ",t.jsx(T,{title:"تغییر آدرس",placeHolder:"آدرس جدید را وارد کنید",onChange:n=>{S(o=>{const m=o;return m.job.address=n,{...m}})}})]})]})}),t.jsxs("div",{className:"flex items-center gap-x-2 px-4 mt-9",children:[t.jsx(fe,{className:"w-5 h-5 fill-blue-500"}),t.jsxs("p",{className:"text-sm text-slate-800 font-[vazir] flex items-center",children:["توضیحات",t.jsx(T,{textArea:!0,title:"تغییر توضیحات",placeHolder:"توضیحات جدید را وارد کنید",onChange:n=>{S(o=>{const m=o;return m.job.description=n,{...m}})}})]})]}),t.jsx("div",{className:"mt-4 w-full px-5",children:t.jsx("div",{className:"w-full rounded-xl bg-blue-500/10 p-5 flex flex-col gap-y-4",children:t.jsx("p",{className:"text-xs text-slate-800 font-[vazir]",children:(O=r==null?void 0:r.job)==null?void 0:O.description})})}),t.jsxs("div",{className:"flex items-center gap-x-2 px-4 mt-9",children:[t.jsx(ye,{className:"w-5 h-5 fill-blue-500"}),t.jsxs("p",{className:"text-sm text-slate-800 font-[vazir] flex items-center",children:["هشتگ   ",t.jsx(B,{title:"هشتگ",modalBody:t.jsx("div",{className:"w-full space-y-3 pb-2",children:t.jsx(Ie,{ref:z,placeHolder:"هشتگ",icon:t.jsx(Ce,{className:"w-5 h-5 fill-blue-500 stroke-blue-500"}),debounce:0,onBeforeChange:n=>n.trim()===""?!1:n.endsWith(" ")?(u(o=>o?[...o,{id:te(),value:n.trim()}]:[{id:te(),value:n.trim()}]),""):!0})}),children:t.jsx("div",{className:"p-1.5 rounded-lg hover:bg-emerald-500/10 cursor-pointer transition-colors duration-300",children:t.jsx(L,{className:"w-4 h-4 fill-transparent stroke-emerald-500"})})})]})]}),t.jsx("div",{className:"flex items-center gap-x-2 px-4 mt-4",children:(g==null?void 0:g.length)>0?t.jsx("div",{className:"flex items-center gap-x-2 mt-3",children:g==null?void 0:g.map(n=>t.jsx("p",{onClick:()=>{u(o=>o.filter(m=>m.id!==n.id))},className:` select-none py-1 px-2 flex-wrap rounded-lg bg-blue-500/5 hover:bg-blue-500/20\r
                                            transition-colors duration-300 cursor-pointer text-sm font-[vazir]`,children:n.value},n.id))}):null}),t.jsxs("div",{className:"mt-9 w-full px-4",children:[t.jsxs("div",{className:"flex items-center w-full justify-between",children:[t.jsxs("div",{className:"flex items-center gap-x-2",children:[t.jsx(Ne,{className:"w-[1.35rem] h-[1.35rem] fill-blue-500"}),t.jsx("p",{className:"text-sm text-slate-800 font-[vazir]",children:"موقعیت مکانی"})]}),t.jsx("a",{href:`https://www.google.com/maps?q=${(W=r==null?void 0:r.job)==null?void 0:W.lat},${(P=r==null?void 0:r.job)==null?void 0:P.lng}`,target:"_blank",className:`text-sm text-blue-500 font-[vazir] py-1.5 px-2.5 rounded-xl hover:bg-blue-500/5\r
                        transition-colors duration-300`,children:"ورود به مسیریابی"})]}),t.jsx("div",{className:"mt-6 w-full max-w-4xl mx-auto",children:t.jsx(be,{zoom:16,latlng:[{latlng:new He.LatLng((G=r==null?void 0:r.job)==null?void 0:G.lat,(F=r==null?void 0:r.job)==null?void 0:F.lng),title:(U=r==null?void 0:r.job)==null?void 0:U.title}]})})]}),t.jsxs("div",{className:"flex items-center gap-x-2 px-4 mt-12",children:[t.jsx(he,{className:"w-5 h-5 fill-blue-500"}),t.jsx("p",{className:"text-sm text-slate-800 font-[vazir]",children:"ساعات کاری مجموعه"})]}),(e==null?void 0:e.length)>0?t.jsxs("div",{className:"mt-14 grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 gap-3 px-4 w-full",children:[e.map((n,o)=>{var m,k,E,K,Q,X,Y,D,ee;return t.jsx(ze,{index:o,show_is_holiday:!0,is_holiday:n.is_holiday,startMorningTime:e[o].start_morning_time,endMorningTime:e[o].end_morning_time,startAfternoonTime:e[o].start_afternoon_time,endAfternoonTime:e[o].end_afternoon_time,is_afternoon_holiday:e[o].is_afternoon_holiday,is_morning_holiday:e[o].is_morning_holiday,show_is_afternoon_holiday:!0,show_is_morning_holiday:!0,onIsHolidayChange:(l,x)=>{const y=[];Array.from({length:e.length}).forEach((a,s)=>{var _,d,c,f,h;s===l?y.push({day:e[l].day,start_morning_time:i(e[s].start_morning_time,8),end_morning_time:i(e[s].end_morning_time,14),start_afternoon_time:i(e[s].start_afternoon_time,16),end_afternoon_time:i(e[s].end_afternoon_time,22),is_holiday:x,is_afternoon_holiday:(_=e[s])==null?void 0:_.is_afternoon_holiday,is_morning_holiday:(d=e[s])==null?void 0:d.is_morning_holiday}):y.push({day:e[s].day,start_morning_time:i(e[s].start_morning_time,8),end_morning_time:i(e[s].end_morning_time,14),start_afternoon_time:i(e[s].start_afternoon_time,16),end_afternoon_time:i(e[s].end_afternoon_time,22),is_holiday:(c=e[s])==null?void 0:c.is_holiday,is_afternoon_holiday:(f=e[s])==null?void 0:f.is_afternoon_holiday,is_morning_holiday:(h=e[s])==null?void 0:h.is_morning_holiday})}),w(y)},setMorningTime:l=>{const x=[];Array.from({length:e.length}).forEach((y,a)=>{var s,_,d,c,f,h,H;a===o?x.push({day:(s=e[o])==null?void 0:s.day,start_morning_time:i(l.start_morning_time,8),end_morning_time:i(l.end_morning_time,14),start_afternoon_time:i(e[a].start_afternoon_time,16),end_afternoon_time:i(e[a].end_afternoon_time,22),is_holiday:(_=e[a])==null?void 0:_.is_holiday,is_afternoon_holiday:(d=e[a])==null?void 0:d.is_afternoon_holiday,is_morning_holiday:(c=e[a])==null?void 0:c.is_morning_holiday}):x.push({day:e[a].day,start_morning_time:i(e[a].start_morning_time,8),end_morning_time:i(e[a].end_morning_time,14),start_afternoon_time:i(e[a].start_afternoon_time,16),end_afternoon_time:i(e[a].end_afternoon_time,22),is_holiday:(f=e[a])==null?void 0:f.is_holiday,is_afternoon_holiday:(h=e[a])==null?void 0:h.is_afternoon_holiday,is_morning_holiday:(H=e[a])==null?void 0:H.is_morning_holiday})}),w(x)},setAfternoonTime:l=>{const x=[];Array.from({length:e.length}).forEach((y,a)=>{var s,_,d,c,f,h;a===o?x.push({day:e[o].day,start_morning_time:i(e[a].start_morning_time,8),end_morning_time:i(e[a].end_morning_time,14),start_afternoon_time:i(l.start_afternoon_time,16),end_afternoon_time:i(l.end_afternoon_time,22),is_holiday:(s=e[a])==null?void 0:s.is_holiday,is_afternoon_holiday:(_=e[a])==null?void 0:_.is_afternoon_holiday,is_morning_holiday:(d=e[a])==null?void 0:d.is_morning_holiday}):x.push({day:e[a].day,start_morning_time:i(e[a].start_morning_time,8),end_morning_time:i(e[a].end_morning_time,14),start_afternoon_time:i(e[a].start_afternoon_time,16),end_afternoon_time:i(e[a].end_afternoon_time,22),is_holiday:(c=e[a])==null?void 0:c.is_holiday,is_afternoon_holiday:(f=e[a])==null?void 0:f.is_afternoon_holiday,is_morning_holiday:(h=e[a])==null?void 0:h.is_morning_holiday})}),w(x)},onIsMorningHolidayChange:(l,x)=>{console.log("on morning hi=oliday change");const y=[];Array.from({length:e.length}).forEach((a,s)=>{var _,d,c,f,h;s===l?y.push({day:e[l].day,start_morning_time:i(e[s].start_morning_time,8),end_morning_time:i(e[s].end_morning_time,14),start_afternoon_time:i(e[s].start_afternoon_time,16),end_afternoon_time:i(e[s].end_afternoon_time,22),is_holiday:(_=e[l])==null?void 0:_.is_holiday,is_afternoon_holiday:(d=e[s])==null?void 0:d.is_afternoon_holiday,is_morning_holiday:x}):y.push({day:e[s].day,start_morning_time:i(e[s].start_morning_time,8),end_morning_time:i(e[s].end_morning_time,14),start_afternoon_time:i(e[s].start_afternoon_time,16),end_afternoon_time:i(e[s].end_afternoon_time,22),is_holiday:(c=e[s])==null?void 0:c.is_holiday,is_afternoon_holiday:(f=e[s])==null?void 0:f.is_afternoon_holiday,is_morning_holiday:(h=e[s])==null?void 0:h.is_morning_holiday})}),w(y)},onIsAfternoonHolidayChange:(l,x)=>{console.log("on afternnon change");const y=[];Array.from({length:e.length}).forEach((a,s)=>{var _,d,c,f,h,H;s===l?y.push({day:(_=e[l])==null?void 0:_.day,start_morning_time:i(e[s].start_morning_time,8),end_morning_time:i(e[s].end_morning_time,14),start_afternoon_time:i(e[s].start_afternoon_time,16),end_afternoon_time:i(e[s].end_afternoon_time,22),is_holiday:(d=e[l])==null?void 0:d.is_holiday,is_afternoon_holiday:x,is_morning_holiday:(c=e[s])==null?void 0:c.is_morning_holiday}):y.push({day:e[s].day,start_morning_time:i(e[s].start_morning_time,8),end_morning_time:i(e[s].end_morning_time,14),start_afternoon_time:i(e[s].start_afternoon_time,16),end_afternoon_time:i(e[s].end_afternoon_time,22),is_holiday:(f=e[s])==null?void 0:f.is_holiday,is_afternoon_holiday:(h=e[s])==null?void 0:h.is_afternoon_holiday,is_morning_holiday:(H=e[s])==null?void 0:H.is_morning_holiday})}),w(y)},children:t.jsx("div",{className:"h-full",children:t.jsx(ve,{day_name:je(e[o].day),is_holiday:o===6&&((m=e==null?void 0:e[6])==null?void 0:m.is_holiday)||n.is_holiday,start_morning_time:n.is_morning_holiday?"--":`${(k=n.start_morning_time)==null?void 0:k.format("HH")}:${(E=n.start_morning_time)==null?void 0:E.format("mm")}`,end_morning_time:n.is_morning_holiday?"--":`${(K=n.end_morning_time)==null?void 0:K.format("HH")}:${(Q=n.end_morning_time)==null?void 0:Q.format("mm")}`,start_afternoon_time:n.is_afternoon_holiday?"--":`${(X=n.start_afternoon_time)==null?void 0:X.format("HH")}:${(Y=n.start_afternoon_time)==null?void 0:Y.format("mm")}`,end_afternoon_time:n.is_afternoon_holiday?"--":`${(D=n.end_afternoon_time)==null?void 0:D.format("HH")}:${(ee=n.end_afternoon_time)==null?void 0:ee.format("mm")}`},o)})})}),t.jsx("div",{className:"grid place-items-center",children:t.jsx("div",{className:"w-16 h-16 bg-blue-500 rounded-full cursor-pointer"})})]}):null,((q=r==null?void 0:r.comments)==null?void 0:q.length)>0?t.jsx("div",{className:"mt-16 w-full",children:t.jsx(pe,{jobTitle:(V=r==null?void 0:r.job)==null?void 0:V.title,jobId:(Z=r==null?void 0:r.job)==null?void 0:Z.id,comments:r==null?void 0:r.comments})}):!1,t.jsx("button",{onClick:se,className:"primary-btn mt-20 w-full max-w-sm block mx-auto",children:"ذخیره تغییرات"})]})}export{Ke as default};
