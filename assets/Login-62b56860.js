import{j as e,r as m,m as f,i as v}from"./index-d8fa4cee.js";import{A as b,c as j,u as p,s as w,B as N,a as _,l as k,g as S}from"./App-8c327c57.js";import{S as L}from"./SelectCitiesModal-67cb6c97.js";import{u as x}from"./chunk-ENIANY67-29a1425c.js";import"./index-475e6dc5.js";import"./chunk-XY72533R-a83d5600.js";import"./chunk-ROURZMX4-7a6e0355.js";import"./chunk-D5UZ3RNN-f24ace12.js";import"./objectWithoutProperties-50301d67.js";import"./Modal_1-9bec9291.js";import"./chunk-VFYM6BU6-d8b2c4d2.js";async function g(t){const s={method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({phone_number:t.phoneNumber.toString()})};return await(await fetch(b+"/auth/get_phone_number",s)).json()}async function z({code:t,user_id:s}){const r=await(await fetch(j,{method:"POST",headers:{"Content-Type":"application/json",Accept:"application/json"},body:JSON.stringify({code:t.toString(),user_id:s.toString()})})).json();return new Promise(i=>{i({is_correct:r.is_correct,message:r.message,role:r.role,status:r.status,token:r.token,user_id:r.user_id})})}async function C({avatar:t,city_id:s,first_name:r,last_name:i,username:a}){const u=w,l={method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer "+p.getState().user.token},body:JSON.stringify({first_name:r,last_name:i,city_id:s,username:a,avatar:void 0})},d=await fetch(u,l);if(d.ok)return await d.json();throw new Error("something went wrong")}const y=({data:t,step:s})=>{switch(s){case"getPhoneNumber":p.getState().api.setUser({userid:t.userid,phone:t.phone,...t});break;case"checkOtp":p.getState().api.setUser({role:t.role,status:t.status,token:t.token,...t});break}};function W(){const t=p(s=>s.user);if(t.phone){if(typeof t.role>"u"||typeof t.status>"u"||!t.token)return e.jsx(h,{children:e.jsx(A,{})});if(!t.firstname||!t.lastname||!t.username)return e.jsx(h,{children:e.jsx(R,{})})}else return e.jsx(h,{children:e.jsx(O,{})});return e.jsx(h,{children:e.jsx(U,{})})}function h({children:t}){return e.jsxs("div",{className:"w-full min-h-screen grid grid-cols-1 grid-rows-1 relative",children:[e.jsxs("p",{className:"text-gray-50 text-xs tracking-wide fixed bottom-4 left-4 z-20 font-[vazirThin]",children:["powerd by ",e.jsx("span",{className:"text-white font-[vazirBold]",children:"Orbyx"})]}),t]})}function O(){const t=m.useRef(null),s=f(a=>a.setIsLoading),r=x(),i=()=>{t.current.value.trim()===""?r({description:"شماره موبایل را وراد کنید",duration:4e3,isClosable:!0,status:"warning",position:"top-right"}):(s(!0),g({phoneNumber:t.current.value}).then(a=>{y({step:"getPhoneNumber",data:{phone:a.phone_number,userid:a.user_id}}),s(!1)}))};return e.jsxs("div",{dir:"ltr",className:"w-full h-full grid grid-cols-1 lg:grid-cols-[50%_1fr]",children:[e.jsx("div",{className:"bg-blue-400 grid place-items-center",children:e.jsxs("div",{dir:"rtl",className:"flex flex-col items-center justify-center gap-y-8 w-full p-6 overflow-y-auto",children:[e.jsx("div",{className:"relative overflow-hidden",children:e.jsx("img",{alt:"",src:v()+"/images/login_vector.png",className:"w-80 h-auto"})}),e.jsx("p",{className:"text-white text-sm font-[vazir] tracking-wide leading-6",children:"لورم ایپسوم متن ساختگی با تولید سادگی نامفهوم از صنعت چاپ، و با استفاده از طراحان گرافیک است، چاپگرها و متون بلکه روزنامه و مجله در ستون و سطرآنچنان که لازم است، و برای شرایط فعلی تکنولوژی مورد نیاز، و کاربردهای متنوع با هدف بهبود ابزارهای کاربردی می باشد، کتابهای زیادی در شصت و سه درصد گذشته حال و آینده، شناخت فراوان جامعه و متخصصان را می طلبد، تا با نرم افزارها شناخت بیشتری را برای طراحان رایانه ای علی الخصوص طراحان خلاقی، و فرهنگ پیشرو در زبان فارسی ایجاد کرد، در این صورت می توان امید داشت که تمام و دشواری موجود در ارائه راهکارها، و شرایط سخت تایپ به پایان رسد و زمان مورد نیاز شامل حروفچینی دستاوردهای اصل."})]})}),e.jsx("div",{dir:"rtl",className:"grid place-items-center bg-gray-100 max-lg:py-16 max-lg:pb-32",children:e.jsxs("div",{className:"flex flex-col gap-y-3 w-full max-w-sm",children:[e.jsx("p",{className:"text-xs font-[vazir] text-blue-500/80 tracking-wide text-center mb-3",children:"موبایل"}),e.jsx("input",{maxLength:11,minLength:11,className:"primary-text-input",placeholder:"شماره تماس",onKeyDown:a=>{a.key==="Enter"&&i()},ref:t}),e.jsx("button",{onClick:i,className:`w-full rounded-xl border-none focus:outline-none text-white text-sm\r
                    bg-blue-500 cursor-pointer active:scale-95 duration-300 py-4 px-5`,children:"ورود"})]})})]})}function A(){const t=m.useRef(null),[s,r]=p(n=>[n.user,n.api]),[i,a]=m.useState(!1),u=x(),l=f(n=>n.setIsLoading),d=()=>{t.current.value.trim()?(a(!0),z({code:parseInt(t.current.value),user_id:s.userid}).then(n=>{n.is_correct?(localStorage.setItem(k,n.token),y({step:"checkOtp",data:{userid:s.userid,phone:s.phone,role:n.role,status:n.status,token:n.token}}),n.status===1?S({token:n.token}).then(c=>{r.setUser({firstname:c.data.first_name,lastname:c.data.last_name,phone:c.data.phone_number,role:c.data.role,status:1,userid:c.data.id,username:c.data.username,avatar:c.data.avatar,city_id:c.data.city_id,city:c.data.city,token:n.token,isLoggedIn:!0}),setTimeout(()=>{a(!1)},75)}).catch(()=>{a(!1)}):n.status===0&&(r.set_status(n.status),r.set_token(n.token),r.set_role(n.role),a(!1))):(a(!1),u({description:"کد وارد شده اشتباه است",duration:4e3,isClosable:!0,status:"warning",position:"top-right"}))})):u({description:"کد تایید ارسال شده را وارد کنید",duration:4e3,isClosable:!0,status:"warning",position:"top-right"})},o=()=>{r.setUser({phone:""})};return e.jsx("div",{className:"w-full h-full grid place-items-center p-6 bg-blue-500",children:e.jsxs("div",{className:"w-full max-w-lg rounded-xl bg-gray-100 p-6 py-10 shadow-lg shadow-black/10",children:[e.jsx("p",{className:"text-slate-700 text-xl font-[vazirMedium] tracking-wide",children:"تایید شماره تماس"}),e.jsx("p",{className:"text-sm text-slate-600 font-[vazir] mt-4",children:"کد پیامک شده به شماره ی وارد شده را وارد کنید"}),e.jsx("p",{className:"text-sm text-slate-700 font-[vazir] mt-2",children:s.phone}),e.jsxs("div",{className:"flex flex-col gap-y-5 mt-12",children:[e.jsx("input",{ref:t,onKeyDown:n=>{n.key==="Enter"&&d()},maxLength:10,className:"primary-text-input py-3 font-[vazir]",placeholder:"کد تایید"}),e.jsxs("button",{onClick:()=>{l(!0),g({phoneNumber:s.phone}).then(()=>{l(!1)})},className:"primary-btn bg-emerald-600 px-6 w-max mx-auto flex items-center gap-x-2",children:["ارسال دوباره",e.jsx(N,{className:"w-5 h-5 fill-gray-50"})]}),e.jsxs("div",{className:"flex items-center gap-x-3 max-sm:flex-col max-sm:mt-3",children:[e.jsxs("button",{onClick:d,className:"primary-btn mt-5 flex-shrink-0 relative overflow-hidden flex-[3]",children:[i?e.jsx("div",{className:"absolute top-0 left-0 w-full h-full z-10 bg-blue-500 grid place-items-center",children:e.jsx("div",{className:"w-6 h-6 aspect-square rounded-full border-t border-t-white animate-spin"})}):!1,"بررسی"]}),e.jsx("button",{onClick:o,className:"primary-btn flex-shrink-0 bg-rose-500 mt-5 relative overflow-hidden flex-1",children:"تغییر شماره"})]})]})]})})}function R(){const[t]=_(),s=m.useRef(null),r=m.useRef(null),i=m.useRef(null),[a,u,l]=p(o=>[o.user.city,o.user.city_id,o.api]),d=()=>{s.current.value.trim()!==""||r.current.value.trim()!==""||i.current.value.trim()!==""?C({avatar:void 0,city_id:u,first_name:r.current.value,last_name:i.current.value,username:s.current.value}).then(o=>{console.log(o),l.set_city(a),l.set_city_id(u),l.set_first_name(r.current.value),l.set_last_name(i.current.value),l.set_username(s.current.value),l.set_is_logged_in(!0)}).catch(o=>{alert("something went wrong"),console.log(o)}):alert("fill fields")};return e.jsx("div",{className:"w-full h-full grid place-items-center p-6 bg-blue-500",children:e.jsxs("div",{className:"w-full max-w-lg rounded-xl bg-gray-100 p-6 py-10",children:[e.jsx("p",{className:"text-slate-700 text-xl font-[vazirMedium] tracking-wide mb-12",children:t("signup")}),e.jsxs("div",{className:"flex flex-col gap-y-5",children:[e.jsx("input",{maxLength:16,className:"primary-text-input py-3 font-[vazir]",placeholder:"نام *",ref:r}),e.jsx("input",{maxLength:16,className:"primary-text-input py-3 font-[vazir]",placeholder:"نام خانوادگی*",ref:i}),e.jsx("input",{maxLength:32,className:"primary-text-input py-3 font-[vazir]",placeholder:"نام کاربری *",ref:s}),e.jsx(L,{children:e.jsx("input",{maxLength:32,className:"primary-text-input py-3 font-[vazir]",placeholder:"شهر *",value:a})}),e.jsx("button",{onClick:d,className:"primary-btn mt-5",children:"ثبت نام"})]})]})})}function U(){return e.jsx("div",{className:"w-full h-full bg-gray-100 grid place-items-center",children:e.jsx("div",{className:"w-10 h-10 rounded-full border-t border-slate-900 animate-spin"})})}export{W as default};
